#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import json
import os.path
import subprocess
import time
import traceback

import parted

from log import MeticulousLogger
from named_thread import NamedThread
from notifications import Notification, NotificationManager, NotificationResponse

logger = MeticulousLogger.getLogger(__name__)


# Bootloader
PARTITIONS = [
    {
        "name": "uboot",
        "aligned": False,
        "start": 0x000020,  # in KiB
        "end": 0x002020,  # in KiB
        "fs": "fat32",
    },
    {
        "name": "uboot_env",
        "aligned": False,
        "start": 0x002020,
        "end": 0x004020,
        "fs": "fat32",
    },
    {
        "name": "root_a",
        "aligned": True,
        "start": 0x004400,
        "end": 0x504400,
        "fs": "ext4",
        "bootable": True,
    },
    {
        "name": "root_b",
        "aligned": True,
        "start": 0x504400,
        "end": 0xA04400,
        "fs": "ext4",
        "bootable": True,
    },
    # User partition fills the rest of the image
    {
        "name": "user",
        "aligned": True,
        "start": 0xA04400,
        "end": 0xA04400 + 0x2000,
        "fs": "ext4",
    },
]

PROVISION_DIR = "/meticulous-user/provisioning/"
BOOTLOADER_IMAGE = os.path.join(PROVISION_DIR, "imx-boot-sd.bin")
BOOTLOADER_SCRIPT = os.path.join(PROVISION_DIR, "u-boot.scr")
ROOTFS_ARCHIVE = os.path.join(PROVISION_DIR, "meticulous-rootfs.tar")

NOTIFICATION_IMAGE = "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QCMRXhpZgAATU0AKgAAAAgABQEGAAMAAAABAAIAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAAHigAwAEAAAAAQAAAHgAAAAA/+EKHmh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8APD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczpJcHRjNHhtcEV4dD0iaHR0cDovL2lwdGMub3JnL3N0ZC9JcHRjNHhtcEV4dC8yMDA4LTAyLTI5LyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiBJcHRjNHhtcEV4dDpBcnR3b3JrVGl0bGU9IklNR18wMTUzIj4gPGRjOnRpdGxlPiA8cmRmOkFsdD4gPHJkZjpsaSB4bWw6bGFuZz0ieC1kZWZhdWx0Ij5JTUdfMDE1MzwvcmRmOmxpPiA8L3JkZjpBbHQ+IDwvZGM6dGl0bGU+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg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"
CHECKMARK_IMAGE = "data:image/png;base64,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"
ERROR_IMAGE = "data:image/png;base64,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"


class DiscImager:
    copy_thread = None

    def __init__(self, device):
        self.device = device
        self.notification = Notification("")
        self.notification.image = NOTIFICATION_IMAGE

    @staticmethod
    def needsImaging():
        if not os.path.exists(BOOTLOADER_IMAGE):
            logger.info(f"Bootloader image '{BOOTLOADER_IMAGE}' does not exist.")
            return False
        if not os.path.exists(BOOTLOADER_SCRIPT):
            logger.info(f"Bootloader script '{BOOTLOADER_SCRIPT}' does not exist.")
            return False
        if not os.path.exists(ROOTFS_ARCHIVE):
            logger.info(f"Root filesystem archive '{ROOTFS_ARCHIVE}' does not exist.")
            return False
        return True

    def create_partitions(self):
        self.updateNotication("Creating Partitions")
        device = parted.getDevice(self.device)
        logger.info(f"created {device}")

        sector_size = device.sectorSize
        logger.info(f"sector size is {sector_size}")

        disk = parted.freshDisk(device, "gpt")
        logger.info(f"created {disk}")
        # ../../../emmc.img1       64    16447    16384    8M Linux filesystem
        # ../../../emmc.img2    16448    32831    16384    8M Linux filesystem
        # ../../../emmc.img3    34816 10520575 10485760    5G EFI System
        # ../../../emmc.img4 10520576 21006335 10485760    5G EFI System
        # ../../../emmc.img5 21006336 30535643  9529308  4,5G Linux filesystem
        logger.info("Creating partitions...")
        for i, partition in enumerate(PARTITIONS):
            logger.info("\n\n----------------------\n\n")
            start = partition["start"] * 1024 // sector_size
            end = (partition["end"] * 1024 // sector_size) - 1

            name = partition["name"]
            fs = partition["fs"]
            size = (end - start) * sector_size // 1024
            logger.info(
                f"Partition: {partition['name']}, Start: {partition['start']} KiB, Size: {size} KiB"
            )
            geometry = parted.Geometry(
                device=device,
                start=start,
                end=end if end > start else start + 512 * 1024 // sector_size,
            )
            logger.info(f"created {geometry}")
            if i == len(PARTITIONS) - 1:
                free_space_regions = disk.getFreeSpaceRegions()
                geometry = free_space_regions[-1]

            filesystem = parted.FileSystem(type=fs, geometry=geometry)
            logger.info(f"created {filesystem}")

            # Turn off alignment constraints
            constraint = parted.Constraint(exactGeom=geometry, aligned=False)

            part = parted.Partition(
                disk=disk,
                type=parted.PARTITION_NORMAL,
                fs=filesystem,
                geometry=geometry,
            )
            part.set_name(name)
            logger.info(
                f"created {part}",
            )

            disk.addPartition(partition=part, constraint=constraint)
            if partition.get("bootable", False):
                # Mark uboot partition as bootable
                logger.info(f"Marking partition {name} as bootable")
                part.setFlag(parted.PARTITION_BOOT)
            logger.info(
                f"added partition {part}",
            )

        logger.info("Committing changes to disk...")
        disk.commit()
        logger.info("Partitions created successfully.")
        subprocess.run(f"partprobe {self.device}".split(), check=True)
        subprocess.run("sync", check=True)

    def format_partitions(self):
        self.updateNotication("Creating Filesystems")
        logger.info("Formatting partitions...")
        for i, partition in enumerate(PARTITIONS, start=1):
            part_device = f"{self.device}p{i}"
            fs_type = partition["fs"]
            if fs_type == "ext4":
                cmd = f"mkfs.ext4 -F {part_device}"
            elif fs_type == "fat32":
                cmd = f"mkfs.fat -F 32 {part_device}"
            else:
                logger.error(
                    f"Unknown filesystem type: {fs_type} for partition {partition['name']}"
                )
                continue
            logger.info(f"Formatting {part_device} as {fs_type}...")

            result = subprocess.run(cmd.split(), capture_output=True, text=True)
            logger.info(result.stdout)
            if result.returncode != 0:
                logger.error(f"Failed to format {part_device} as {fs_type}")
                logger.error(result.stderr)
            else:
                logger.info(f"Formatted {part_device} as {fs_type}")

        logger.info("syncing disks")
        result = subprocess.run("sync", check=True)

    def mount_partition(self, partition_number):
        part_device = f"{self.device}p{partition_number}"
        mountpoint = f"mount/part{partition_number}"
        os.makedirs(mountpoint, exist_ok=True)

        if os.path.ismount(mountpoint):
            logger.info(f"Partition {partition_number} is already mounted at {mountpoint}.")
            return mountpoint

        cmd = f"mount {part_device} {mountpoint}"

        result = subprocess.run(cmd.split(), capture_output=True, text=True)
        logger.info(result.stdout)
        if result.returncode != 0:
            logger.error(f"Failed to mount partition {partition_number}: {result.stderr}")
            raise RuntimeError(
                f"Failed to mount partition {partition_number} with command '{cmd}'"
            )
        else:
            logger.info(f"Partition {partition_number} mounted successfully.")
            return mountpoint

    def unmount_partition(self, partition_number):
        part_device = f"{self.device}p{partition_number}"
        cmd = f"umount {part_device}"
        result = subprocess.run(cmd.split(), capture_output=True, text=True)
        logger.info(result.stdout)
        if result.returncode != 0:
            logger.info(f"Failed to unmount partition {partition_number}: {result.stderr}")
            raise RuntimeError(
                f"Failed to unmount partition {partition_number} with command '{cmd}'"
            )
        else:
            logger.info(f"Partition {partition_number} unmounted successfully.")

    def write_bootloader(self):
        self.updateNotication("Writing bootloader...")
        logger.info("Writing bootloader...")
        cmd = f"cp {BOOTLOADER_IMAGE} {self.device}p1"
        result = subprocess.run(cmd.split(), capture_output=True, text=True)
        logger.info(result.stdout)
        if result.returncode != 0:
            logger.error(f"Failed to write bootloader: {result.stderr}")
            raise RuntimeError(f"Failed to write bootloader with command '{cmd}'")
        else:
            logger.info("Bootloader written successfully.")

    def write_bootloader_script(self):
        self.updateNotication("Writing bootloader scripts...")
        logger.info("Writing bootloader script...")
        mountpoint = self.mount_partition(2)
        if not mountpoint:
            logger.info("Failed to mount partition 2. Cannot write bootloader script.")
            return

        cmd = f"cp {BOOTLOADER_SCRIPT} {mountpoint}/u-boot.scr"
        result = subprocess.run(cmd.split(), capture_output=True, text=True)
        logger.info(result.stdout)
        if result.returncode != 0:
            logger.error(f"Failed to write bootloader script: {result.stderr}")
            raise RuntimeError("Failed to write bootloader script with command '{cmd}'")
        else:
            logger.info("Bootloader script written successfully.")

        cmd = f"cp {BOOTLOADER_SCRIPT} {mountpoint}/boot.scr"
        result = subprocess.run(cmd.split(), capture_output=True, text=True)
        logger.info(result.stdout)
        if result.returncode != 0:
            logger.error(f"Failed to write bootloader script: {result.stderr}")
            raise RuntimeError("Failed to write bootloader script with command '{cmd}'")
        else:
            logger.info("Bootloader script written successfully.")

        self.unmount_partition(2)

    def write_rootfs(self, partition_number=3):
        self.updateNotication("Writing root filesystem...")
        logger.info("Writing root filesystem...")
        mountpoint = self.mount_partition(partition_number)
        if not mountpoint:
            logger.error(
                f"Failed to mount partition {partition_number}. Cannot write root filesystem."
            )
            return
        in_cmd = [
            "pv",
            "-f",
            "--format",
            # for old PV from 2015
            '{"elapsed":"%t","bytes":"%b","rate":"%r","eta":"%e"}',
            # for more modern PV versions
            # '\'{"elapsed":%t,"bytes":%b,"rate":%r,"percentage":%{progress-amount-only}}\'',
            ROOTFS_ARCHIVE,
        ]

        tar_cmd = f"tar -x -C {mountpoint}"
        pv = subprocess.Popen(
            in_cmd,
            shell=False,
            bufsize=1,
            stderr=subprocess.PIPE,
            stdout=subprocess.PIPE,
            universal_newlines=True,
            env={"LANG": "C.UTF-8", "LC_ALL": "C.UTF-8"},
        )
        tar = subprocess.Popen(
            tar_cmd.split(),
            shell=False,
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE,
            stdin=pv.stdout,
        )
        pv.stdout.close()  # Allow pv to receive a SIGPIPE if mysql exits.
        for line in pv.stderr:
            json_data = line.rstrip("\n")
            progression = json.loads(json_data)
            logger.info(
                f"Elapsed: {progression['elapsed']}s - "
                f"Eta: {progression['eta']} - "
                f"Bytes: {progression['bytes']} - "
                f"Rate: {progression['rate']}"
            )
            self.updateNotication(
                f"Elapsed: {progression['elapsed']}s \n"
                f"Eta: {progression['eta']} \n"
                f"Bytes: {progression['bytes']} \n"
                f"Rate: {progression['rate']}"
            )

        pv_returncode = pv.wait()
        tar_returncode = tar.wait()
        if pv_returncode != 0:
            logger.error("Failed to read root filesystem archive")
            for line in pv.stderr:
                logger.info(line.rstrip("\n").encode().decode())
            logger.error(f"Return code: {pv_returncode}")
            raise RuntimeError(
                f"PV Failed to read root filesystem archive with return code {pv_returncode}"
            )
        if tar_returncode != 0:
            logger.error("Failed to write root filesystem")
            for line in tar.stderr:
                logger.error(line.rstrip("\n".encode()).decode())
            logger.error(f"Return code: {tar_returncode}")
            raise RuntimeError(
                f"TAR Failed to write root filesystem with return code {tar_returncode}"
            )
        self.updateNotication(
            f"Root filesystem written successfully to partition {partition_number}",
            responses=[NotificationResponse.OK],
        )
        self.unmount_partition(partition_number)

    def updateNotication(self, message, responses=None, image=None):
        self.notification.message = message
        if responses is not None:
            self.notification.responses = responses
        else:
            self.notification.responses = [
                NotificationResponse.OK,
            ]
        NotificationManager.add_notification(self.notification)

    @staticmethod
    def flash():
        logger.info("Starting to image emmc")
        waitTime = 10
        imager = DiscImager(device="/dev/mmcblk2")
        time.sleep(waitTime)

        imager.updateNotication(
            f"Starting to image emmc in {waitTime} seconds",
            responses=[
                NotificationResponse.OK,
                NotificationResponse.SKIP,
            ],
        )
        time.sleep(waitTime)
        if (
            imager.notification.acknowledged
            and imager.notification.response == NotificationResponse.SKIP
        ):
            return

        start_time = time.time()
        try:
            imager.create_partitions()
            imager.format_partitions()
            imager.write_bootloader()
            imager.write_bootloader_script()
            imager.write_rootfs(partition_number=3)
        except Exception as e:
            logger.error(f"An error occurred during imaging: {e}")
            traceback.print_exc()
            imager.updateNotication(
                f"An error occurred during imaging: {e}\nCheck the logs for details.",
                responses=[NotificationResponse.OK],
                image=ERROR_IMAGE,
            )
            return
        end_time = time.time()
        elapsed = end_time - start_time
        logger.info(f"Total imaging time: {elapsed:.2f} seconds")
        imager.updateNotication(
            f"Imaging completed successfully in {elapsed:.2f} seconds",
            responses=[NotificationResponse.OK],
            image=CHECKMARK_IMAGE,
        )

    @staticmethod
    def flash_if_required():
        if not DiscImager.needsImaging():
            return
        logger.info("Imaging is required. Provisioning the device...")
        DiscImager.copy_thread = NamedThread("DiscImager", target=DiscImager.flash)
        DiscImager.copy_thread.start()
