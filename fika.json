{
 "name": "UI",
 "stages": [
  {
   "name": "heating",
   "nodes": [
    {
     "id": -1,
     "controllers": [
      {
       "kind": "time_reference",
       "id": 2
      }
     ],
     "triggers": [
      {
       "kind": "water_detection_trigger",
       "value": true,
       "next_node_id": 7
      },
      {
       "kind": "water_detection_trigger",
       "value": false,
       "next_node_id": 6
      }
     ]
    },
    {
     "id": 6,
     "controllers": [
      {
       "kind": "log_controller",
       "message": "No Water"
      }
     ],
     "triggers": [
      {
       "kind": "timer_trigger",
       "timer_reference_id": 2,
       "operator": ">=",
       "value": 2,
       "next_node_id": 5
      },
      {
       "kind": "timer_trigger",
       "timer_reference_id": 1,
       "operator": ">=",
       "value": 100,
       "next_node_id": -2
      }
     ]
    },
    {
     "id": 7,
     "controllers": [
      {
       "kind": "temperature_controller",
       "algorithm": "Cylinder Temperature PID v1.0",
       "curve": {
        "id": 0,
        "interpolation_kind": "linear_interpolation",
        "points": [
         [
          0,
          150
         ]
        ],
        "time_reference_id": 2
       }
      }
     ],
     "triggers": [
      {
       "kind": "temperature_value_trigger",
       "source": "Tube Temperature",
       "operator": ">=",
       "value": 80,
       "next_node_id": 8
      },
      {
       "kind": "timer_trigger",
       "timer_reference_id": 2,
       "operator": ">=",
       "value": 900,
       "next_node_id": -2
      }
     ]
    },
    {
     "id": 8,
     "controllers": [
      {
       "kind": "temperature_controller",
       "algorithm": "Cylinder Temperature PID v1.0",
       "curve": {
        "id": 1,
        "interpolation_kind": "linear_interpolation",
        "points": [
         [
          0,
          25
         ]
        ],
        "time_reference_id": 2
       }
      },
      {
       "kind": "move_piston_controller",
       "algorithm": "Piston Ease-In",
       "direction": "UP",
       "speed": 4
      }
     ],
     "triggers": [
      {
       "kind": "piston_position_trigger",
       "position_reference_id": 0,
       "operator": "<=",
       "value": 55,
       "next_node_id": 9,
       "source": "Piston Position Raw"
      }
     ]
    },
    {
     "id": 9,
     "controllers": [
      {
       "kind": "move_piston_controller",
       "algorithm": "Piston Ease-In",
       "direction": "UP",
       "speed": 6
      }
     ],
     "triggers": [
      {
       "kind": "piston_speed_trigger",
       "operator": "==",
       "value": 0,
       "next_node_id": 25
      }
     ]
    },
    {
     "id": 25,
     "controllers": [
      {
       "kind": "tare_controller"
      },
      {
       "kind": "time_reference",
       "id": 10
      }
     ],
     "triggers": [
      {
       "kind": "exit",
       "next_node_id": 26
      }
     ]
    },
    {
     "id": 26,
     "controllers": [
      {
       "kind": "weight_reference",
       "id": 1
      }
     ],
     "triggers": [
      {
       "kind": "timer_trigger",
       "timer_reference_id": 10,
       "operator": ">=",
       "value": 10,
       "next_node_id": 21
      }
     ]
    },
    {
     "id": 21,
     "controllers": [
      {
       "kind": "move_piston_controller",
       "algorithm": "Piston Ease-In",
       "direction": "DOWN",
       "speed": 5
      },
      {
       "kind": "time_reference",
       "id": 3
      }
     ],
     "triggers": [
      {
       "kind": "pressure_value_trigger",
       "source": "Pressure Raw",
       "operator": ">=",
       "value": 0.2,
       "next_node_id": 27
      }
     ]
    },
    {
     "id": 27,
     "controllers": [
      {
       "kind": "temperature_controller",
       "algorithm": "Water Temperature ONOFF v1.0",
       "curve": {
        "id": 10,
        "interpolation_kind": "linear_interpolation",
        "points": [
         [
          0,
          120
         ]
        ],
        "time_reference_id": 2
       }
      },
      {
       "kind": "move_piston_controller",
       "algorithm": "Piston Ease-In",
       "direction": "DOWN",
       "speed": 0
      }
     ],
     "triggers": [
      {
       "kind": "temperature_value_trigger",
       "source": "Plunger Temperature",
       "operator": ">=",
       "value": 120,
       "next_node_id": 10
      }
     ]
    }
   ]
  },
  {
   "name": "preinfusion",
   "nodes": [
    {
     "id": 10,
     "controllers": [
      {
       "kind": "flow_controller",
       "algorithm": "Flow PID v1.0",
       "curve": {
        "id": 4,
        "interpolation_kind": "catmull_interpolation",
        "points": [
         [
          0,
          0
         ],
         [
          1,
          0
         ]
        ],
        "time_reference_id": 3
       }
      }
     ],
     "triggers": [
      {
       "kind": "timer_trigger",
       "timer_reference_id": 3,
       "operator": ">=",
       "value": 1,
       "next_node_id": 12
      },
      {
       "kind": "pressure_value_trigger",
       "source": "Pressure Predictive",
       "operator": ">=",
       "value": 6,
       "next_node_id": 11
      },
      {
       "kind": "weight_value_trigger",
       "source": "Weight Raw",
       "weight_reference_id": 1,
       "operator": ">=",
       "value": 2,
       "next_node_id": 12
      }
     ]
    },
    {
     "id": 11,
     "controllers": [
      {
       "kind": "pressure_controller",
       "algorithm": "Pressure PID v1.0",
       "curve": {
        "id": 6,
        "interpolation_kind": "catmull_interpolation",
        "points": [
         [
          0,
          6
         ]
        ],
        "time_reference_id": 3
       }
      }
     ],
     "triggers": [
      {
       "kind": "timer_trigger",
       "timer_reference_id": 3,
       "operator": ">=",
       "value": 1,
       "next_node_id": 12
      },
      {
       "kind": "flow_curve_trigger",
       "source": "Flow Raw",
       "operator": ">=",
       "curve_id": 4,
       "next_node_id": 10
      },
      {
       "kind": "weight_value_trigger",
       "source": "Weight Raw",
       "weight_reference_id": 1,
       "operator": ">=",
       "value": 2,
       "next_node_id": 12
      }
     ]
    }
   ]
  },
  {
   "name": "infusion",
   "nodes": [
    {
     "id": 12,
     "controllers": [
      {
       "kind": "time_reference",
       "id": 4
      }
     ],
     "triggers": [
      {
       "kind": "exit",
       "next_node_id": 13
      }
     ]
    },
    {
     "id": 13,
     "controllers": [
      {
       "kind": "pressure_controller",
       "algorithm": "Pressure PID v1.0",
       "curve": {
        "id": 7,
        "interpolation_kind": "catmull_interpolation",
        "points": [
         [
          0,
          2
         ],
         [
          40,
          2
         ]
        ],
        "time_reference_id": 4
       }
      },
      {
       "kind": "position_reference",
       "id": 1
      }
     ],
     "triggers": [
      {
       "kind": "timer_trigger",
       "timer_reference_id": 4,
       "operator": ">=",
       "value": 40,
       "next_node_id": 14
      },
      {
       "kind": "weight_value_trigger",
       "source": "Weight Raw",
       "weight_reference_id": 1,
       "operator": ">=",
       "value": 33,
       "next_node_id": 14
      },
      {
       "kind": "flow_value_trigger",
       "source": "Flow Raw",
       "operator": ">=",
       "value": 8,
       "next_node_id": 20
      }
     ]
    },
    {
     "id": 20,
     "controllers": [
      {
       "kind": "flow_controller",
       "algorithm": "Flow PID v1.0",
       "curve": {
        "id": 9,
        "interpolation_kind": "catmull_interpolation",
        "points": [
         [
          0,
          8
         ]
        ],
        "time_reference_id": 3
       }
      },
      {
       "kind": "position_reference",
       "id": 1
      }
     ],
     "triggers": [
      {
       "kind": "timer_trigger",
       "timer_reference_id": 4,
       "operator": ">=",
       "value": 40,
       "next_node_id": 14
      },
      {
       "kind": "weight_value_trigger",
       "source": "Weight Raw",
       "weight_reference_id": 1,
       "operator": ">=",
       "value": 33,
       "next_node_id": 14
      },
      {
       "kind": "pressure_curve_trigger",
       "source": "Pressure Raw",
       "operator": ">=",
       "curve_id": 7,
       "next_node_id": 13
      }
     ]
    },
    {
     "id": 14,
     "controllers": [
      {
       "kind": "move_piston_controller",
       "algorithm": "Piston Fast",
       "direction": "UP",
       "speed": 6
      }
     ],
     "triggers": [
      {
       "kind": "piston_position_trigger",
       "position_reference_id": 1,
       "operator": "<=",
       "value": -4,
       "next_node_id": 15,
       "source": "Piston Position Raw"
      }
     ]
    },
    {
     "id": 15,
     "controllers": [
      {
       "kind": "move_piston_controller",
       "algorithm": "Piston Fast",
       "direction": "UP",
       "speed": 2
      },
      {
       "kind": "time_reference",
       "id": 5
      },
      {
       "kind": "time_reference",
       "id": 6
      }
     ],
     "triggers": [
      {
       "kind": "piston_position_trigger",
       "position_reference_id": 1,
       "operator": "<=",
       "value": -15,
       "source": "Piston Position Raw",
       "next_node_id": -2
      }
     ]
    },
    {
     "id": -2,
     "controllers": [
      {
       "kind": "end_profile"
      }
     ],
     "triggers": []
    }
   ]
  }
 ]
}
