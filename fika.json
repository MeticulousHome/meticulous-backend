{
    "name": "italian",
    "stages": [
      {
        "name": "initialize",
        "nodes": [
          {
            "id": -1,
            "controllers": [],
            "triggers": [
              {
                "kind": "piston_position_trigger",
                "position_reference_id": 0,
                "operator": ">=",
                "value": 60,
                "next_node_id": 5,
                "source": "Piston Position Raw"
              },
              {
                "kind": "piston_position_trigger",
                "position_reference_id": 0,
                "operator": "<",
                "value": 60,
                "next_node_id": 4,
                "source": "Piston Position Raw"
              }
            ]
          },
          {
            "id": 4,
            "controllers": [
              {
                "kind": "move_piston_controller",
                "algorithm": "Piston Ease-In",
                "direction": "DOWN",
                "speed": 4
              },
              {
                "kind": "time_reference",
                "id": 1
              }
            ],
            "triggers": [
              {
                "kind": "piston_position_trigger",
                "position_reference_id": 0,
                "next_node_id": 5,
                "operator": ">=",
                "value": 60,
                "source": "Piston Position Raw"
              }
            ]
          },
          {
            "id": 5,
            "controllers": [
              {
                "kind": "time_reference",
                "id": 2
              }
            ],
            "triggers": [
              {
                "kind": "water_detection_trigger",
                "value": true,
                "next_node_id": 7
              },
              {
                "kind": "water_detection_trigger",
                "value": false,
                "next_node_id": 6
              }
            ]
          },
          {
            "id": 6,
            "controllers": [
              {
                "kind": "log_controller",
                "message": "No Water"
              }
            ],
            "triggers": [
              {
                "kind": "timer_trigger",
                "timer_reference_id": 2,
                "operator": ">=",
                "value": 2,
                "next_node_id": 5
              },
              {
                "kind": "timer_trigger",
                "timer_reference_id": 1,
                "operator": ">=",
                "value": 100,
                "next_node_id": -2
              }
            ]
          },
          {
            "id": 7,
            "controllers": [
              {
                "kind": "temperature_controller",
                "algorithm": "Cylinder Temperature PID v1.0",
                "curve": {
                  "id": 0,
                  "interpolation_kind": "linear_interpolation",
                  "points": [[0, 150]],
                  "time_reference_id": 2
                }
              }
            ],
            "triggers": [
              {
                "kind": "temperature_value_trigger",
                "source": "Tube Temperature",
                "operator": ">=",
                "value": 89,
                "next_node_id": 8
              },
              {
                "kind": "timer_trigger",
                "timer_reference_id": 2,
                "operator": ">=",
                "value": 900,
                "next_node_id": -2
              }
            ]
          },
          {
            "id": 8,
            "controllers": [
              {
                "kind": "temperature_controller",
                "algorithm": "Cylinder Temperature PID v1.0",
                "curve": {
                  "id": 0,
                  "interpolation_kind": "linear_interpolation",
                  "points": [[0, 25]],
                  "time_reference_id": 2
                }
              },
              {
                "kind": "move_piston_controller",
                "algorithm": "Piston Ease-In",
                "direction": "UP",
                "speed": 0.5
              }
            ],
            "triggers": [
              {
                "kind": "piston_position_trigger",
                "position_reference_id": 0,
                "operator": "<=",
                "value": 55,
                "next_node_id": 9,
                "source": "Piston Position Raw"
              }
            ]
          },
          {
            "id": 9,
            "controllers": [
              {
                "kind": "move_piston_controller",
                "algorithm": "Piston Ease-In",
                "direction": "UP",
                "speed": 6
              },
              {
                "kind": "time_reference",
                "id": 3
              },
              {
                "kind": "weight_reference",
                "id": 1
              }
            ],
            "triggers": [
              {
                "kind": "piston_speed_trigger",
                "operator": "==",
                "value": 0,
                "next_node_id": 10
              }
            ]
          }
        ]
      },
      {
        "name": "Pre Infusion",
        "nodes": [
          {
            "id": 10,
            "controllers": [
              {
                "kind": "temperature_controller",
                "algorithm": "Cylinder Temperature PID v1.0",
                "curve": {
                  "id": 3,
                  "interpolation_kind": "linear_interpolation",
                  "points": [[0, 25]],
                  "time_reference_id": 2
                }
              },
              {
                "kind": "flow_controller",
                "algorithm": "Flow PID v1.0",
                "curve": {
                  "id": 4,
                  "interpolation_kind": "linear_interpolation",
                  "points": [[0, 4]],
                  "time_reference_id": 3
                }
              }
            ],
            "triggers": [
              {
                "kind": "timer_trigger",
                "timer_reference_id": 3,
                "operator": ">=",
                "value": 10,
                "next_node_id": 12
              },
              {
                "kind": "pressure_value_trigger",
                "source": "Pressure Predictive",
                "operator": ">=",
                "value": 6,
                "next_node_id": 11
              },
              {
                "kind": "weight_value_trigger",
                "source": "Weight Raw",
                "weight_reference_id": 1,
                "operator": ">=",
                "value": 0.2,
                "next_node_id": 12
              }
            ]
          },
          {
            "id": 11,
            "controllers": [
              {
                "kind": "pressure_controller",
                "algorithm": "Pressure PID v1.0",
                "curve": {
                  "id": 6,
                  "interpolation_kind": "linear_interpolation",
                  "points": [[0, 6]],
                  "time_reference_id": 3
                }
              }
            ],
            "triggers": [
              {
                "kind": "timer_trigger",
                "timer_reference_id": 3,
                "operator": ">=",
                "value": 10,
                "next_node_id": 12
              },
              {
                "kind": "flow_curve_trigger",
                "source": "Flow Raw",
                "operator": ">=",
                "curve_id": 4,
                "next_node_id": 10
              },
              {
                "kind": "weight_value_trigger",
                "source": "Weight Raw",
                "weight_reference_id": 1,
                "operator": ">=",
                "value": 0.2,
                "next_node_id": 12
              }
            ]
          }
        ]
      },
      {
        "name": "Infusion",
        "nodes": [
          {
            "id": 12,
            "controllers": [
              {
                "kind": "time_reference",
                "id": 4
              }
            ],
            "triggers": [
              {
                "kind": "exit",
                "next_node_id": 13
              }
            ]
          },
          {
            "id": 13,
            "controllers": [
              {
                "kind": "temperature_controller",
                "algorithm": "Cylinder Temperature PID v1.0",
                "curve": {
                  "id": 6,
                  "interpolation_kind": "linear_interpolation",
                  "points": [[0, 25]],
                  "time_reference_id": 4
                }
              },
              {
                "kind": "pressure_controller",
                "algorithm": "Pressure PID v1.0",
                "curve": {
                  "id": 7,
                  "interpolation_kind": "linear_interpolation",
                  "points": [
                    [0, 8],
                    [10, 6]
                  ],
                  "time_reference_id": 4
                }
              },
              {
                "kind": "position_reference",
                "id": 1
              }
            ],
            "triggers": [
              {
                "kind": "timer_trigger",
                "timer_reference_id": 4,
                "operator": ">=",
                "value": 60,
                "next_node_id": 14
              },
              {
                "kind": "weight_value_trigger",
                "source": "Weight Raw",
                "weight_reference_id": 1,
                "operator": ">=",
                "value": 36,
                "next_node_id": 14
              }
            ]
          },
          {
            "id": 14,
            "controllers": [
              {
                "kind": "move_piston_controller",
                "algorithm": "Piston Fast",
                "direction": "UP",
                "speed": 6
              }
            ],
            "triggers": [
              {
                "kind": "piston_position_trigger",
                "position_reference_id": 1,
                "operator": "<=",
                "value": -4,
                "next_node_id": 15,
                "source": "Piston Position Raw"
              }
            ]
          },
          {
            "id": 15,
            "controllers": [
              {
                "kind": "move_piston_controller",
                "algorithm": "Piston Fast",
                "direction": "UP",
                "speed": 2
              }
            ],
            "triggers": [
              {
                "kind": "piston_position_trigger",
                "position_reference_id": 1,
                "operator": "<=",
                "value": -15,
                "source": "Piston Position Raw",
                "next_node_id": 16
              }
            ]
          }
        ]
      },
      {
        "name": "Purge",
        "nodes": [
          {
            "id": 16,
            "controllers": [
              {
                "kind": "temperature_controller",
                "algorithm": "Cylinder Temperature PID v1.0",
                "curve": {
                  "id": 7,
                  "interpolation_kind": "linear_interpolation",
                  "points": [[0, 25]],
                  "time_reference_id": 4
                }
              },
              {
                "kind": "time_reference",
                "id": 5
              }
            ],
            "triggers": [
              {
                "kind": "timer_trigger",
                "timer_reference_id": 4,
                "operator": ">=",
                "value": 10,
                "next_node_id": 18
              },
              {
                "kind": "weight_value_trigger",
                "source": "Weight Raw",
                "weight_reference_id": 1,
                "operator": "<=",
                "value": -20,
                "next_node_id": 17
              }
            ]
          },
          {
            "id": 17,
            "controllers": [],
            "triggers": [
              {
                "kind": "timer_trigger",
                "timer_reference_id": 5,
                "operator": ">=",
                "value": 5,
                "next_node_id": 19
              }
            ]
          },
          {
            "id": 18,
            "controllers": [
              {
                "kind": "log_controller",
                "message": "Remove Cup"
              }
            ],
            "triggers": [
              {
                "kind": "weight_value_trigger",
                "source": "Weight Raw",
                "weight_reference_id": 1,
                "operator": "<=",
                "value": -20,
                "next_node_id": 17
              },
              {
                "kind": "weight_value_trigger",
                "source": "Weight Raw",
                "weight_reference_id": 1,
                "operator": ">=",
                "value": 5,
                "next_node_id": 16
              },
              {
                "kind": "timer_trigger",
                "timer_reference_id": 5,
                "operator": ">=",
                "value": 1000,
                "next_node_id": -2
              }
            ]
          },
          {
            "id": 19,
            "controllers": [
              {
                "kind": "pressure_controller",
                "algorithm": "Pressure PID v1.0",
                "curve": {
                  "id": 8,
                  "interpolation_kind": "linear_interpolation",
                  "points": [[0, 6]],
                  "time_reference_id": 4
                }
              }
            ],
            "triggers": [
              {
                "kind": "piston_position_trigger",
                "source": "Piston Position Raw",
                "position_reference_id": 0,
                "operator": ">=",
                "value": 60,
                "next_node_id": -2
              }
            ]
          },
          {
            "id": -2,
            "controllers": [
              {
                "kind": "end_profile"
              }
            ],
            "triggers": []
          }
        ]
      }
    ]
  }
